router id 10.234.56.78;

flow4 table myflow4;
flow6 table myflow6;

protocol static f4 {
  flow4 { table myflow4; };

  route flow4 {
    dst 10.0.0.0/8;
    length > 1024;
  } {
    bgp_ext_community.add((unknown 0x810c, 1.1.1.1, 0));
  };
}

protocol static f6 {
  flow6 { table myflow6; };

  route flow6 {
    dst fec0:1122:3344:5566:7788:99aa:bbcc:ddee/128;
    tcp flags 0x03/0x0f && !0/0xff || 0x33/0x33;
    dport = 6000;
    fragment !is_fragment || !first_fragment;
  } {
    bgp_community.add((65001, 11451));
    bgp_ext_community.add((generic, 0x080060000, 0));
    bgp_ext_community.add((ro, 65002, 1919));
  };
}

protocol bgp flow_test {
  debug all;

  local ::1 port @@BIRD_PORT@@ as 65000;
  neighbor ::1 port @@FLOW_PORT@@ as 65000;
  multihop;

  ipv4 { import none; export all; };
  ipv6 { import none; export all; };
  flow4 { table myflow4; import none; export all; };
  flow6 { table myflow6; import none; export all; };
}
